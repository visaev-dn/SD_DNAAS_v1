! Q-in-Q Configuration for {{ local_leaf }} to {{ remote_leaf }}
! Generated by Network LAB Automation Framework

interface {{ port }}
  description {{ description }}
  switchport mode dot1q-tunnel
  switchport access vlan {{ outer_vlan }}
  spanning-tree portfast
  no shutdown

{% for vlan in inner_vlans %}
service-instance {{ vlan }} ethernet
  encapsulation dot1q {{ vlan }}
  bridge-domain {{ vlan }}
  rewrite ingress tag pop 1 symmetric
{% endfor %}

! VLAN configuration
vlan {{ outer_vlan }}
  name QINQ-{{ local_leaf }}-{{ remote_leaf }}

{% for vlan in inner_vlans %}
vlan {{ vlan }}
  name INNER-{{ vlan }}-{{ local_leaf }}-{{ remote_leaf }}
{% endfor %}

! Bridge domain configuration
{% for vlan in inner_vlans %}
interface Vlan{{ vlan }}
  description Bridge domain for VLAN {{ vlan }}
  no shutdown
{% endfor %} 